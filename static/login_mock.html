<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - ClinicConnect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: {
                            DEFAULT: "hsl(var(--primary))",
                            foreground: "hsl(var(--primary-foreground))",
                        },
                        secondary: {
                            DEFAULT: "hsl(var(--secondary))",
                            foreground: "hsl(var(--secondary-foreground))",
                        },
                        destructive: {
                            DEFAULT: "hsl(var(--destructive))",
                            foreground: "hsl(var(--destructive-foreground))",
                        },
                        muted: {
                            DEFAULT: "hsl(var(--muted))",
                            foreground: "hsl(var(--muted-foreground))",
                        },
                        accent: {
                            DEFAULT: "hsl(var(--accent))",
                            foreground: "hsl(var(--accent-foreground))",
                        },
                        popover: {
                            DEFAULT: "hsl(var(--popover))",
                            foreground: "hsl(var(--popover-foreground))",
                        },
                        card: {
                            DEFAULT: "hsl(var(--card))",
                            foreground: "hsl(var(--card-foreground))",
                        },
                    },
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 222.2 84% 4.9%;
            --primary: 221.2 83.2% 53.3%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96.1%;
            --secondary-foreground: 222.2 47.4% 11.2%;
            --muted: 210 40% 96.1%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96.1%;
            --accent-foreground: 222.2 47.4% 11.2%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 221.2 83.2% 53.3%;
            --radius: 0.5rem;
        }
    </style>
</head>
<body class="bg-background text-foreground font-sans antialiased min-h-screen flex animate-fade-in">

    <!-- Left Panel - Brand -->
    <div class="hidden lg:flex lg:w-1/2 bg-primary relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-br from-primary via-primary to-accent opacity-90"></div>
        <div class="relative z-10 flex flex-col justify-center items-center text-center px-12 text-primary-foreground w-full h-full">
            <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center mb-6 shadow-xl">
                <i data-lucide="heart" class="w-10 h-10 text-primary"></i>
            </div>
            <h1 class="text-4xl font-bold mb-4">ClinicConnect</h1>
            <p class="text-lg text-primary-foreground/90 max-w-md text-balance">
                Connecting patients with quality healthcare providers through seamless technology
            </p>
            <div class="mt-12 space-y-4 text-left w-full max-w-md">
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5">
                        <span class="text-sm font-semibold">✓</span>
                    </div>
                    <div>
                        <p class="font-medium">500+ Verified Clinics</p>
                        <p class="text-sm text-primary-foreground/80">Trusted healthcare providers nationwide</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5">
                        <span class="text-sm font-semibold">✓</span>
                    </div>
                    <div>
                        <p class="font-medium">AI-Powered Assistance</p>
                        <p class="text-sm text-primary-foreground/80">Smart symptom checker and recommendations</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5">
                        <span class="text-sm font-semibold">✓</span>
                    </div>
                    <div>
                        <p class="font-medium">Instant Booking</p>
                        <p class="text-sm text-primary-foreground/80">Schedule appointments in seconds</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Panel - Form -->
        <!-- Right Panel - Form -->
    <div class="flex-1 flex items-center justify-center p-6 lg:p-12 bg-background">
        <div class="w-full max-w-md">
            <button onclick="window.location.href='main_page.html'" class="mb-8 text-sm text-muted-foreground hover:text-foreground transition-colors flex items-center gap-1">
                <i data-lucide="arrow-left" class="w-4 h-4"></i> Back to home
            </button>

            <div class="mb-8">
                <h2 id="auth-title" class="text-3xl font-bold text-foreground mb-2">Welcome back</h2>
                <p id="auth-subtitle" class="text-muted-foreground">Sign in to access your account</p>
            </div>

            <!-- Tabs -->
            <div class="w-full">
                <div class="grid w-full grid-cols-2 mb-8 p-1 bg-muted rounded-lg">
                    <button onclick="switchTab('patient')" id="tab-trigger-patient" class="inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-background text-foreground shadow-sm">Patient</button>
                    <button onclick="switchTab('staff')" id="tab-trigger-staff" class="inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 text-muted-foreground hover:bg-background/50 hover:text-foreground">Clinic Staff</button>
                </div>

                <!-- Patient Form -->
                <div id="tab-content-patient">
                    <form onsubmit="handleAuth(event, 'patient')" class="space-y-4">
                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="patient-email">Email</label>
                            <div class="relative">
                                <i data-lucide="mail" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"></i>
                                <input id="patient-email" type="email" placeholder="your.email@example.com" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pl-10" required>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="patient-password">Password</label>
                            <div class="relative">
                                <i data-lucide="lock" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"></i>
                                <input id="patient-password" type="password" placeholder="••••••••" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pl-10" required>
                            </div>
                        </div>

                        <button type="submit" class="auth-submit-btn inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-11 px-8 w-full">
                            Sign in as Patient
                        </button>

                        <p class="text-center text-sm text-muted-foreground">
                            <span class="auth-switch-text">Don't have an account?</span>
                            <button type="button" onclick="toggleAuthMode()" class="auth-switch-btn text-primary hover:underline font-medium">
                                Sign up
                            </button>
                        </p>
                    </form>
                </div>

                <!-- Staff Form -->
                <div id="tab-content-staff" class="hidden">
                    <form onsubmit="handleAuth(event, 'staff')" class="space-y-4">
                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="staff-email">Email</label>
                            <div class="relative">
                                <i data-lucide="mail" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"></i>
                                <input id="staff-email" type="email" placeholder="staff@clinic.com" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pl-10" required>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="staff-password">Password</label>
                            <div class="relative">
                                <i data-lucide="lock" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"></i>
                                <input id="staff-password" type="password" placeholder="••••••••" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pl-10" required>
                            </div>
                        </div>

                        <button type="submit" class="auth-submit-btn inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-11 px-8 w-full">
                            Sign in as Staff
                        </button>

                        <p class="text-center text-sm text-muted-foreground">
                            Need access? Contact your administrator.
                        </p>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isLogin = true;

        function switchTab(tab) {
            const patientContent = document.getElementById('tab-content-patient');
            const staffContent = document.getElementById('tab-content-staff');
            const patientTrigger = document.getElementById('tab-trigger-patient');
            const staffTrigger = document.getElementById('tab-trigger-staff');

            if (tab === 'patient') {
                patientContent.classList.remove('hidden');
                staffContent.classList.add('hidden');
                patientTrigger.className = "inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-background text-foreground shadow-sm";
                staffTrigger.className = "inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 text-muted-foreground hover:bg-background/50 hover:text-foreground";
            } else {
                patientContent.classList.add('hidden');
                staffContent.classList.remove('hidden');
                staffTrigger.className = "inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-background text-foreground shadow-sm";
                patientTrigger.className = "inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 text-muted-foreground hover:bg-background/50 hover:text-foreground";
            }
        }

        function toggleAuthMode() {
            isLogin = !isLogin;
            
            // Update Titles
            document.getElementById('auth-title').innerText = isLogin ? "Welcome back" : "Create Account";
            document.getElementById('auth-subtitle').innerText = isLogin ? "Sign in to access your account" : "Enter your details to get started";

            // Handle Tab Visibility
            const staffTab = document.getElementById('tab-trigger-staff');
            const tabsContainer = staffTab.parentElement;
            
            if (!isLogin) {
                // If switching to Sign Up, ensure we are on Patient tab
                switchTab('patient');
                // Hide Staff tab
                staffTab.classList.add('hidden');
                tabsContainer.classList.remove('grid-cols-2');
                tabsContainer.classList.add('grid-cols-1');
            } else {
                // If switching to Login, show Staff tab
                staffTab.classList.remove('hidden');
                tabsContainer.classList.remove('grid-cols-1');
                tabsContainer.classList.add('grid-cols-2');
            }

            // Update Buttons and Links
            const submitBtns = document.querySelectorAll('.auth-submit-btn');
            const switchTexts = document.querySelectorAll('.auth-switch-text');
            const switchBtns = document.querySelectorAll('.auth-switch-btn');

            submitBtns.forEach(btn => {
                const role = btn.innerText.includes('Staff') ? 'Staff' : 'Patient';
                btn.innerText = isLogin ? `Sign in as ${role}` : `Sign up as ${role}`;
            });

            switchTexts.forEach(text => {
                text.innerText = isLogin ? "Don't have an account?" : "Already have an account?";
            });

            switchBtns.forEach(btn => {
                btn.innerText = isLogin ? "Sign up" : "Sign in";
            });
        }

        async function handleAuth(event, type) {
            event.preventDefault();
            
            let email, password;
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerText;
            
            if (type === 'staff') {
                email = document.getElementById('staff-email').value;
                password = document.getElementById('staff-password').value;
            } else {
                email = document.getElementById('patient-email').value;
                password = document.getElementById('patient-password').value;
            }

            // Show loading state
            submitBtn.disabled = true;
            submitBtn.innerText = isLogin ? "Signing in..." : "Creating account...";

            const endpoint = isLogin ? '/api/login' : '/api/signup';

            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password, role: type })
                });

                const data = await response.json();

                if (data.success) {
                    if (isLogin) {
                        // Store user info if needed
                        localStorage.setItem('user', JSON.stringify(data.user));
                        
                        // Redirect based on role
                        if (type === 'staff') {
                            window.location.href = 'dashboard.html';
                        } else {
                            window.location.href = 'patient_chat.html';
                        }
                    } else {
                        alert("Account created successfully! Please check your email to confirm your account before logging in.");
                        toggleAuthMode(); // Switch back to login
                    }
                } else {
                    alert(data.message || (isLogin ? "Login failed" : "Signup failed"));
                }
            } catch (error) {
                console.error('Auth error:', error);
                alert("An error occurred. Please try again.");
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerText = originalText;
            }
        }

        lucide.createIcons();
    </script>


</body>
</html>